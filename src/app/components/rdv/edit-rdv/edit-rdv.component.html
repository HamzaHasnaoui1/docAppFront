<nz-card *ngIf="!loading" nzTitle="Modifier Rendez-vous" nzHoverable class="form-card">
  <form [formGroup]="rdvForm" (ngSubmit)="onSubmit()" nz-form nzLayout="vertical">

    <!-- Section Informations de base -->
    <nz-card nzTitle="Informations du rendez-vous" nzType="inner" class="section-card">
      <div nz-row [nzGutter]="16">
        <div nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-label nzFor="date" nzRequired>Date et heure</nz-form-label>
            <nz-form-control>
              <input nz-input type="datetime-local" id="date" formControlName="date" class="full-width" />
            </nz-form-control>
          </nz-form-item>
        </div>

        <div nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-label nzFor="statusRDV" nzRequired>Statut</nz-form-label>
            <nz-form-control>
              <nz-select id="statusRDV" formControlName="statusRDV" class="full-width">
                <nz-option nzValue="PENDING" nzLabel="En attente"></nz-option>
                <nz-option nzValue="CONFIRMED" nzLabel="Confirmé"></nz-option>
                <nz-option nzValue="CANCELLED" nzLabel="Annulé"></nz-option>
                <nz-option nzValue="DONE" nzLabel="Terminé"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>

      <div nz-row [nzGutter]="16">
        <div nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-label nzFor="medecin" nzRequired>Médecin</nz-form-label>
            <nz-form-control>
              <nz-form-text>
                {{ medecin }}
                <input type="hidden" formControlName="medecin" />
              </nz-form-text>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-label nzFor="patient" nzRequired>Patient</nz-form-label>
            <nz-form-control>
              <nz-form-text>
                {{ patient }}
                <input type="hidden" formControlName="patient" />
              </nz-form-text>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>

      <div nz-row [nzGutter]="16">
        <div nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-label nzFor="prix">Prix</nz-form-label>
            <nz-form-control>
              <nz-input-number id="prix" formControlName="prix" [nzMin]="0" [nzStep]="10" class="full-width"></nz-input-number>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col [nzSpan]="12">
          <nz-form-item>
            <nz-form-label nzFor="archivee">Archivée</nz-form-label>
            <nz-form-control>
              <nz-switch id="archivee" formControlName="archivee" nzCheckedChildren="Oui" nzUnCheckedChildren="Non"></nz-switch>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
    </nz-card>

    <!-- Section Rapport médical -->
    <nz-card nzTitle="Rapport médical" nzType="inner" class="section-card">
      <nz-form-item>
        <nz-form-control>
          <textarea nz-input id="rapport" rows="3" formControlName="rapport" placeholder="Notes du rendez-vous..."></textarea>
        </nz-form-control>
      </nz-form-item>
    </nz-card>

    <!-- Section Ordonnance -->
    <nz-card nzTitle="Ordonnance médicale" nzType="inner" class="section-card" formGroupName="ordonnance">
      <div nz-row [nzGutter]="16">
        <div nz-col [nzSpan]="24">
          <nz-form-item>
            <nz-form-label nzFor="contenu">Prescription</nz-form-label>
            <nz-form-control>
              <textarea nz-input id="contenu" rows="2" formControlName="contenu" placeholder="Détails de la prescription..."></textarea>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div nz-col [nzSpan]="24">
          <nz-form-item>
            <nz-form-label nzFor="remarques">Remarques</nz-form-label>
            <nz-form-control>
              <textarea nz-input id="remarques" rows="2" formControlName="remarques" placeholder="Instructions spéciales..."></textarea>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>

      <!-- Section Médicaments -->
      <div class="medicaments-section">
        <h3>Médicaments prescrits</h3>
        <div formArrayName="medicaments" class="medicaments-list">
          <div *ngFor="let med of medicaments.controls; let i = index" [formGroupName]="i" class="medicament-item">
            <div nz-row [nzGutter]="16" nzAlign="top">
              <div nz-col [nzSpan]="6">
                <nz-form-item>
                  <nz-form-label nzRequired>Médicament</nz-form-label>
                  <nz-form-control>
                    <input nz-input formControlName="medicament" placeholder="Nom du médicament" class="full-width" />
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col [nzSpan]="4">
                <nz-form-item>
                  <nz-form-label nzRequired>Posologie</nz-form-label>
                  <nz-form-control>
                    <input nz-input formControlName="posologie" placeholder="ex: 1 comprimé" class="full-width" />
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col [nzSpan]="4">
                <nz-form-item>
                  <nz-form-label>Durée</nz-form-label>
                  <nz-form-control>
                    <input nz-input formControlName="duree" placeholder="ex: 7 jours" class="full-width" />
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col [nzSpan]="4">
                <nz-form-item>
                  <nz-form-label>Fréquence</nz-form-label>
                  <nz-form-control>
                    <input nz-input formControlName="frequence" placeholder="ex: 2 fois/jour" class="full-width" />
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col [nzSpan]="4">
                <nz-form-item>
                  <nz-form-label>Instructions</nz-form-label>
                  <nz-form-control>
                    <input nz-input formControlName="instructions" placeholder="Instructions" class="full-width" />
                  </nz-form-control>
                </nz-form-item>
              </div>
              <div nz-col [nzSpan]="2" class="text-right">
                <nz-form-item>
                  <nz-form-control>
                    <button nz-button nzType="text" nzDanger (click)="removeMedicament(i)" nzShape="circle">
                      <span nz-icon nzType="delete" nzTheme="outline"></span>
                    </button>
                  </nz-form-control>
                </nz-form-item>
              </div>
            </div>
          </div>
        </div>
        <button nz-button nzType="dashed" type="button" (click)="addMedicament()" class="add-medicament-btn">
          <span nz-icon nzType="plus"></span> Ajouter un médicament
        </button>
      </div>
    </nz-card>

    <div class="form-actions">
      <button nz-button type="button" (click)="onCancel()" style="margin-right: 8px">Annuler</button>
      <button nz-button nzType="primary" [disabled]="rdvForm.invalid">Enregistrer</button>
    </div>
  </form>
</nz-card>
